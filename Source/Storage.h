/*
 ==============================================================================
 
 Storage.h
 Created: 20 Nov 2023 5:41:08pm
 Author:  Eugene Clewlow
 
 ==============================================================================
 */

#pragma once

#include <JuceHeader.h>
#include "wavetables.h"
#include "Globals.h"

class Storage {
public:
    typedef struct {
        char name[9];
        uint32_t memory_location;
    } WAVE;
    
    typedef struct {
        char name[9];
        WAVE waves[16];
    } WAVETABLE;
    
    Storage() {};
    ~Storage() {};
    int16_t LoadWaveSample(int table, int frame, int index);
    void LoadWaveSample(int16_t * waveform, int16_t wavetable, float morph);
    void LoadWaveSample(int16_t * waveform, int16_t wavetable, int16_t frame);
    bool SaveWavetable(char * name, int table);
    bool SaveWave(const char * name, int16_t * data, int table, int frame);
    bool DeleteWavetable(int table);
    bool WaveDoesExist(int table, int frame);
    int8_t GetNumberOfWavesInTable(int16_t table);
    inline WAVETABLE GetWavetable(int8_t table) { return WaveTables[table]; }
    inline WAVETABLE* GetWavetables() { return WaveTables; }
    //    int16_t NumAvailableWaveSlots();
    //    int16_t NextAvailableWaveSlot();
private:
    // 64 wavetables.  32 Factory, 32 User
    // 1024 waves.  512 Facotry, 512 User
    // 64 snapshots.  64 user.
    int16_t USER_ROM[2048 * USER_WAVE_COUNT];
    
    WAVETABLE WaveTables[FACTORY_WAVETABLE_COUNT + USER_WAVETABLE_COUNT] = {
        {
            "SPECTRAL", {
                {"GRANULAR", 0},
                {"01", 2048},
                {"02", 4096},
                {"03", 6144},
                {"04", 8192},
                {"05", 10240},
                {"06", 12288},
                {"07", 14336},
                {"08", 16384},
                {"09", 18432},
                {"10", 20480},
                {"11", 22528},
                {"12", 24576},
                {"13", 26624},
                {"14", 28672},
                {"15", 30720},
            }
        },
        {
            "TABLE 1", {
                {"00", 32768},
                {"01", 34816},
                {"02", 36864},
                {"03", 38912},
                {"04", 40960},
                {"05", 43008},
                {"06", 45056},
                {"07", 47104},
                {"08", 49152},
                {"09", 51200},
                {"10", 53248},
                {"11", 55296},
                {"12", 57344},
                {"13", 59392},
                {"14", 61440},
                {"15", 63488},
            }
        },
        {
            "TABLE 2", {
                {"00", 65536},
                {"01", 67584},
                {"02", 69632},
                {"03", 71680},
                {"04", 73728},
                {"05", 75776},
                {"06", 77824},
                {"07", 79872},
                {"08", 81920},
                {"09", 83968},
                {"10", 86016},
                {"11", 88064},
                {"12", 90112},
                {"13", 92160},
                {"14", 94208},
                {"15", 96256},
            }
        },
        {
            "TABLE 3", {
                {"00", 98304},
                {"01", 100352},
                {"02", 102400},
                {"03", 104448},
                {"04", 106496},
                {"05", 108544},
                {"06", 110592},
                {"07", 112640},
                {"08", 114688},
                {"09", 116736},
                {"10", 118784},
                {"11", 120832},
                {"12", 122880},
                {"13", 124928},
                {"14", 126976},
                {"15", 129024},
            }
        },
        {
            "TABLE 4", {
                {"00", 131072},
                {"01", 133120},
                {"02", 135168},
                {"03", 137216},
                {"04", 139264},
                {"05", 141312},
                {"06", 143360},
                {"07", 145408},
                {"08", 147456},
                {"09", 149504},
                {"10", 151552},
                {"11", 153600},
                {"12", 155648},
                {"13", 157696},
                {"14", 159744},
                {"15", 161792},
            }
        },
        {
            "TABLE 5", {
                {"00", 163840},
                {"01", 165888},
                {"02", 167936},
                {"03", 169984},
                {"04", 172032},
                {"05", 174080},
                {"06", 176128},
                {"07", 178176},
                {"08", 180224},
                {"09", 182272},
                {"10", 184320},
                {"11", 186368},
                {"12", 188416},
                {"13", 190464},
                {"14", 192512},
                {"15", 194560},
            }
        },
        {
            "TABLE 6", {
                {"00", 196608},
                {"01", 198656},
                {"02", 200704},
                {"03", 202752},
                {"04", 204800},
                {"05", 206848},
                {"06", 208896},
                {"07", 210944},
                {"08", 212992},
                {"09", 215040},
                {"10", 217088},
                {"11", 219136},
                {"12", 221184},
                {"13", 223232},
                {"14", 225280},
                {"15", 227328},
            }
        },
        {
            "TABLE 7", {
                {"00", 229376},
                {"01", 231424},
                {"02", 233472},
                {"03", 235520},
                {"04", 237568},
                {"05", 239616},
                {"06", 241664},
                {"07", 243712},
                {"08", 245760},
                {"09", 247808},
                {"10", 249856},
                {"11", 251904},
                {"12", 253952},
                {"13", 256000},
                {"14", 258048},
                {"15", 260096},
            }
        },
        {
            "TABLE 8", {
                {"00", 262144},
                {"01", 264192},
                {"02", 266240},
                {"03", 268288},
                {"04", 270336},
                {"05", 272384},
                {"06", 274432},
                {"07", 276480},
                {"08", 278528},
                {"09", 280576},
                {"10", 282624},
                {"11", 284672},
                {"12", 286720},
                {"13", 288768},
                {"14", 290816},
                {"15", 292864},
            }
        },
        {
            "TABLE 9", {
                {"00", 294912},
                {"01", 296960},
                {"02", 299008},
                {"03", 301056},
                {"04", 303104},
                {"05", 305152},
                {"06", 307200},
                {"07", 309248},
                {"08", 311296},
                {"09", 313344},
                {"10", 315392},
                {"11", 317440},
                {"12", 319488},
                {"13", 321536},
                {"14", 323584},
                {"15", 325632},
            }
        },
        {
            "TABLE 10", {
                {"00", 327680},
                {"01", 329728},
                {"02", 331776},
                {"03", 333824},
                {"04", 335872},
                {"05", 337920},
                {"06", 339968},
                {"07", 342016},
                {"08", 344064},
                {"09", 346112},
                {"10", 348160},
                {"11", 350208},
                {"12", 352256},
                {"13", 354304},
                {"14", 356352},
                {"15", 358400},
            }
        },
        {
            "TABLE 11", {
                {"00", 360448},
                {"01", 362496},
                {"02", 364544},
                {"03", 366592},
                {"04", 368640},
                {"05", 370688},
                {"06", 372736},
                {"07", 374784},
                {"08", 376832},
                {"09", 378880},
                {"10", 380928},
                {"11", 382976},
                {"12", 385024},
                {"13", 387072},
                {"14", 389120},
                {"15", 391168},
            }
        },
        {
            "TABLE 12", {
                {"00", 393216},
                {"01", 395264},
                {"02", 397312},
                {"03", 399360},
                {"04", 401408},
                {"05", 403456},
                {"06", 405504},
                {"07", 407552},
                {"08", 409600},
                {"09", 411648},
                {"10", 413696},
                {"11", 415744},
                {"12", 417792},
                {"13", 419840},
                {"14", 421888},
                {"15", 423936},
            }
        },
        {
            "TABLE 13", {
                {"00", 425984},
                {"01", 428032},
                {"02", 430080},
                {"03", 432128},
                {"04", 434176},
                {"05", 436224},
                {"06", 438272},
                {"07", 440320},
                {"08", 442368},
                {"09", 444416},
                {"10", 446464},
                {"11", 448512},
                {"12", 450560},
                {"13", 452608},
                {"14", 454656},
                {"15", 456704},
            }
        },
        {
            "TABLE 14", {
                {"00", 458752},
                {"01", 460800},
                {"02", 462848},
                {"03", 464896},
                {"04", 466944},
                {"05", 468992},
                {"06", 471040},
                {"07", 473088},
                {"08", 475136},
                {"09", 477184},
                {"10", 479232},
                {"11", 481280},
                {"12", 483328},
                {"13", 485376},
                {"14", 487424},
                {"15", 489472},
            }
        },
        {
            "TABLE 15", {
                {"00", 491520},
                {"01", 493568},
                {"02", 495616},
                {"03", 497664},
                {"04", 499712},
                {"05", 501760},
                {"06", 503808},
                {"07", 505856},
                {"08", 507904},
                {"09", 509952},
                {"10", 512000},
                {"11", 514048},
                {"12", 516096},
                {"13", 518144},
                {"14", 520192},
                {"15", 522240},
            }
        },
    };
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (Storage);
};
